import MigrationStabilityViz from "@/components/MigrationStabilityViz";

## The Puzzle

If you're a software engineer, you can earn £80,000 in London but only £45,000 in Newcastle. So clearly, everyone should move to London for the higher wages, right?

But wait. A one-bedroom flat costs £2,000/month in London versus £700 in Newcastle. That's £15,600 more per year just for housing. After paying rent, the London worker takes home £56,400 while the Newcastle worker takes home £36,600. London still wins, but the gap has shrunk from £35,000 to £19,800.

And we haven't counted everything yet. Your commute in London might cost £1,800/year versus £600 in Newcastle. A pint costs £6.50 in the former versus £4.20 in the latter. If you go out twice a week, that's another £240/year.

The gap keeps shrinking. Yet London keeps growing. The question is: why does anyone live in expensive cities if the wages don't fully compensate for the costs?

And equally puzzling: if expensive cities are such a bad deal, why doesn't their population fall?

## The Answer: Spatial Equilibrium

The answer is that cities reach an **equilibrium** - a point where people are roughly indifferent about where to live. If London were genuinely a better deal than Newcastle, people would flood in. But as more people arrive:

1. Housing demand increases, pushing up rents
2. More workers means firms can pay slightly lower wages (more competition)
3. The city becomes more crowded, reducing residents' quality of life

Eventually, London becomes just attractive enough (compared to its costs) that people stop moving there. Similarly, if Newcastle became significantly better value, people would move there until it wasn't such a bargain anymore.

This is called **spatial equilibrium** - the state where workers are indifferent between locations because higher costs or lower amenities offset all the gains from high wages.

## A Simple Framework

Let's make this more precise. Imagine workers care about three things:

1. Consumption ($C$): All the stuff you buy except housing, e.g. food, entertainment, transport, etc.
2. Housing ($H$): The size and quality of where you live
3. Amenities ($\theta$): Everything else about a place, e.g. weather, culture, parks, proximity to family

We can represent their satisfaction (utility) as:

$$
U = U(C, H, \theta)
$$

Workers face a budget constraint. If they earn a wage $W$ and housing costs $P$ per unit:

$$
W = C + P \cdot H
$$

Their money goes to either consumption or housing.

### The Equilibrium Condition

Here's the key insight: **in equilibrium, utility must be equal across cities**. If it weren't, people would move from the low-utility city to the high-utility city.

$$
U(\text{London}) = U(\text{Newcastle}) = \bar{U}
$$

where $\bar{U}$ is the reservation utility - the level of satisfaction people can achieve anywhere in the country.

This equation tells us that:

- Higher wages must be offset by higher prices or worse amenities
- Better amenities allow cities to have lower wages or higher prices
- Cheaper housing must come with lower wages or worse amenities

## Working Through an Example

Let's make this concrete with some simplified numbers.

### Scenario 1: No Mobility (Before Equilibrium)

Imagine initially people can't move between cities:

| City      | Wage    | Annual Rent | Consumption | Utility |
| --------- | ------- | ----------- | ----------- | ------- |
| London    | £80,000 | £24,000     | £56,000     | 10.93   |
| Newcastle | £45,000 | £8,400      | £36,600     | 10.51   |

**How these numbers are calculated:**

- **Consumption** = Wage - Annual Rent (what's left after paying for housing)
- **Utility** = $\ln(\text{Consumption})$ (natural logarithm, capturing diminishing marginal utility)
  - London: ln(56,000) = 10.93
  - Newcastle: ln(36,600) = 10.51

London delivers higher utility (10.93 vs 10.51). If we allowed people to move, they'd head to London.

### Scenario 2: People Can Move

As workers move to London:

- Housing demand increases
- Rents are bid up
- Utility in London falls

Simultaneously in Newcastle:

- Housing demand decreases
- Rents fall slightly
- Utility in Newcastle rises

Eventually we reach equilibrium:

| City      | Wage    | Annual Rent | Consumption | Utility |
| --------- | ------- | ----------- | ----------- | ------- |
| London    | £75,000 | £32,000     | £43,000     | 10.67   |
| Newcastle | £51,000 | £9,000      | £42,000     | 10.65   |

**Now utilities are nearly equal** (10.67 vs 10.65)! The movement stops. Notice what happened:

- London's wages fell slightly (from £80k to £75k) as more workers arrived
- Newcastle's wages rose (from £45k to £51k) as workers left
- London's rents rose significantly (from £24k to £32k) due to housing demand
- Newcastle's rents rose slightly (from £8.4k to £9k) despite population falling
- After paying rent, consumption is similar: £43k in London vs £42k in Newcastle
- With logarithmic utility, similar consumption means similar utility: $\ln(43,000) = 10.67$ vs $\ln(42,000) = 10.65$

This is the essence of spatial equilibrium: **workers are indifferent between locations** because high wages are offset by high costs. Migration stops when no one can improve their utility by moving.

### What This Tells Us

This simple model reveals several insights:

1. **Wage differences reflect cost differences**: High-wage cities must be expensive, otherwise everyone would move there
2. **Housing supply matters enormously**: If London could build unlimited housing at £24k/year, rents would never rise to £30k. More people could enjoy London's high productivity without paying the housing premium.
3. **Amenities show up in prices**: If London had better weather (improving $\theta$), it could support even higher house prices while keeping utility equal.

## The Two Equations That Rule Cities

We can distil this down to two fundamental equations:

**Spatial Equilibrium (workers are indifferent):**

$$
U(W_c - P_c H_c, H_c, \theta_c) = \bar{U}
$$

for every city $c$.

**Housing Market Clearing (demand equals supply):**

$$
P_c = f(\text{population}_c, \text{supply constraints}_c)
$$

The first equation says people achieve the same utility everywhere. The second says housing prices adjust to balance demand and supply.

Together, these determine:

- How many people live in each city
- What wages are paid
- What housing costs

## Why This Matters

This framework helps us understand:

**Why are London house prices so high?**

- Either: London is very productive (high $W$), so people are willing to pay more
- Or: London has great amenities (high $\theta$), so people accept lower real wages
- Or: London can't build enough houses, so prices rise to ration the fixed supply

**What happens if we restrict building?**

- If London can't build housing, prices rise
- Higher prices mean fewer people can live there
- The UK gets fewer workers in its most productive city
- National GDP is lower than it could be

**This last point is crucial.** If planning restrictions prevent London from expanding, the entire country is poorer. Not just Londoners—everyone. Workers who would be more productive in London are stuck elsewhere. This is the "spatial misallocation" that economists worry about.

## What's Next

In this section, we've established the basic logic: cities exist in equilibrium where wages, costs, and amenities balance out.

But we've left many questions unanswered:

- Within a city, why are some areas more expensive than others?
- How do firms decide where to locate? (The supply side)
- How do we measure these effects with real data?
- What's the actual cost to the UK economy from planning restrictions?

We'll tackle these in the next sections. For now, remember the core insight: expensive cities aren't costly by accident. They're expensive because they're valuable, and their value attracts people until the high costs keep them away.

## Interactive Example: Migration Stability Diagram

The visualization below implements the spatial equilibrium model mathematically. Here's how the curves and numbers you see are calculated.

### The Model Behind the Graph

We track how utility in each city changes as the population split varies. Let $s$ be the share of the total population living in City A (so $1-s$ lives in City B). The model has four key equations:

**1. Wages adjust with labour supply:**

$$
W_A(s) = W_{A0} \cdot \left(\frac{s}{s_0}\right)^{-\eta_A}, \quad W_B(s) = W_{B0} \cdot \left(\frac{1-s}{1-s_0}\right)^{-\eta_B}
$$

where $W_{c0}$ is the base wage, $s_0 = 0.5$ is the reference split, and $\eta_c$ captures wage sensitivity to labour supply. When more workers move to a city (higher $s$ for City A), wages fall slightly as labour becomes more abundant.

**2. Rents adjust with housing demand:**

$$
P_A(s) = P_{A0} \cdot \left(\frac{s}{s_0}\right)^{1/\varepsilon_A}, \quad P_B(s) = P_{B0} \cdot \left(\frac{1-s}{1-s_0}\right)^{1/\varepsilon_B}
$$

where $P_{c0}$ is the base rent and $\varepsilon_c$ is the housing supply elasticity. Lower elasticity (stricter planning rules) means rents spike dramatically when population increases. This is why the red curve can become very steep when $\varepsilon_A$ is low.

**3. Consumption is what's left after paying rent:**

$$
C_A(s) = W_A(s) - P_A(s) - \gamma_A \cdot \left(\frac{s}{s_0} - 1\right)
$$

$$
C_B(s) = W_B(s) - P_B(s) - \gamma_B \cdot \left(\frac{1-s}{1-s_0} - 1\right)
$$

The $\gamma_c$ terms are optional crowding penalties that capture quality-of-life degradation as cities become more crowded.

**4. Utility follows logarithmic preferences:**

$$
U_A(s) = \ln(C_A(s)), \quad U_B(s) = \ln(C_B(s))
$$

The natural logarithm captures diminishing marginal utility. An extra £10,000 matters more when you're earning £30,000 than when you're earning £60,000.

### How This Creates the Visualization

The **red line** plots $U_A(s)$ as $s$ varies from 0 to 1:

- As $s$ increases, more people live in City A
- This pushes up $P_A(s)$ (more housing demand) and pushes down $W_A(s)$ (more labour supply)
- Both effects reduce $C_A(s)$, which reduces $U_A(s)$
- Result: the red curve slopes downward

The **blue line** plots $U_B(s)$:

- As $s$ increases, fewer people live in City B (since $1-s$ decreases)
- This pushes down $P_B(s)$ (less housing demand) and pushes up $W_B(s)$ (scarcer labour)
- Both effects increase $C_B(s)$, which increases $U_B(s)$
- Result: the blue curve slopes upward

The **equilibrium** $s^*$ is where the curves cross: $U_A(s^*) = U_B(s^*)$. At this point, workers are indifferent between cities. The visualization finds $s^*$ by solving $U_A(s) - U_B(s) = 0$ using bisection search.

The **output boxes** show the values of $W_c$, $P_c$, $C_c$, and $U_c$ evaluated at either the equilibrium $s^*$ or at any point you click.

### Key Insights to Explore

1. **Lower housing elasticity makes curves steeper**: Set City A's $\varepsilon_A = 0.3$ (try "Restrictive Housing in A"). Small population changes cause huge rent spikes, making the red curve very steep. This is why planning restrictions limit city growth.
2. **Wage sensitivity matters less**: The $\eta$ parameters have subtle effects. Wages adjust slowly to population changes, so these curves are relatively flat.
3. **Crowding penalties can shift equilibrium**: Add a crowding penalty to City A ($\gamma_A > 0$). This tilts the red curve downward, moving the equilibrium left (fewer people in A).
4. **No equilibrium = corner solution**: If the curves don't cross, everyone prefers one city. Real cities avoid this through price adjustments, but extreme parameters can produce corner solutions.

<MigrationStabilityViz />

## Key Takeaways

1. Workers move to cities until they're **indifferent** between locations
2. High wages must be offset by high costs or poor amenities
3. Housing supply constraints raise prices and limit city growth
4. These effects have **national** consequences—restricting building in productive cities makes the whole country poorer

_In the next post, we'll zoom into a single city and ask: why do house prices fall as you move away from the centre? This is the Alonso-Muth-Mills model, and it's one of the most elegant results in urban economics._
