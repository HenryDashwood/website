import MigrationStabilityViz from "@/components/blog_components/MigrationStabilityViz";
import PowerLawViz from "@/components/blog_components/PowerLawViz";

## The Puzzle

A software engineer can earn £80,000 in London but only £45,000 in Newcastle. Simple decision, right? Move to London for the extra £35,000.

But wait. A one-bedroom flat costs £2,000/month in London versus £700 in Newcastle. That's £15,600 more per year just for housing. After paying rent, our London worker takes home £56,400 while the Newcastle worker keeps £36,600. London still wins, but the gap has shrunk to £19,800.

And we're not done. The London commute costs £1,800/year versus £600 in Newcastle. A pint costs £6.50 versus £4.20. Go out twice a week and that's another £240 gone. The gap keeps shrinking.

Yet London keeps growing. Why do people choose expensive cities if the wages don't fully compensate for the costs? And if expensive cities are such a bad deal, why doesn't everyone leave?

## The Answer: Spatial Equilibrium

Think about what happens if London genuinely offered a better deal than Newcastle. People would flood in. Housing demand would increase, pushing up rents. More workers mean firms could pay lower wages. The city would become more crowded, reducing quality of life. Eventually, London would be no more attractive than Newcastle and people would stop moving there. Similarly, if Newcastle became significantly better value, people would move to it until it wasn't a bargain anymore.

This is **spatial equilibrium**: a state where workers are indifferent between locations because higher costs or lower amenities offset all the gains from high wages. #TODO check this

## A Simple Framework

Let's formalise this. Imagine workers care about three things:

- Consumption ($C$) - all the stuff you buy except housing
- Housing ($H$) - the size and quality of where you live
- Amenities ($\theta$) - everything else about a place, from weather to culture to proximity to family.

We can represent their satisfaction (utility $U$) as:

$$
U = U(C, H, \theta)
$$

Workers face a budget constraint. If they earn wage $W$ and housing $H$ costs $P$ per unit:

$$
W = C + P \cdot H
$$

Their money goes to either consumption or housing.

In equilibrium, utility must be equal across cities. If it weren't, people would move from the low-utility city to the high-utility city. So:

$$
U(\text{London}) = U(\text{Newcastle}) = \bar{U}
$$

where $\bar{U}$ is the reservation utility, the level of satisfaction people can achieve anywhere in the country.

Higher wages must be offset by higher prices or worse amenities. Better amenities allow a city to maintain a given population while having lower wages or higher prices. Cheaper housing must come with lower wages or worse amenities.

## Working Through an Example

Let's make this concrete. Imagine initially that people can't move between cities:

| City      | Wage    | Annual Rent | Consumption | Utility |
| --------- | ------- | ----------- | ----------- | ------- |
| London    | £80,000 | £24,000     | £56,000     | 10.93   |
| Newcastle | £45,000 | £8,400      | £36,600     | 10.51   |

Consumption equals wage minus rent, what's left after paying for housing. Utility is $\ln(\text{Consumption})$, the natural logarithm that captures diminishing marginal utility. London delivers 10.93 versus Newcastle's 10.51. If we allowed people to move, they'd head to London.

Then we let them move. As workers relocate to London, housing demand increases and rents are bid up. Utility in London falls. Simultaneously in Newcastle, housing demand decreases and rents fall slightly. Utility in Newcastle rises.

Eventually we reach equilibrium:

| City      | Wage    | Annual Rent | Consumption | Utility |
| --------- | ------- | ----------- | ----------- | ------- |
| London    | £75,000 | £32,000     | £43,000     | 10.67   |
| Newcastle | £51,000 | £9,000      | £42,000     | 10.65   |

The utilities are nearly equal (10.67 vs 10.65), so the movement stops. Look at what happened: London's wages fell from £80k to £75k as more workers arrived. Newcastle's wages rose from £45k to £51k as workers left. London's rents rose sharply from £24k to £32k due to housing demand. After paying rent, consumption is nearly identical: £43k in London versus £42k in Newcastle. With logarithmic utility, similar consumption means similar utility.

This is spatial equilibrium in action. Workers are indifferent between locations because high wages are offset by high costs. Migration stops when no one can improve their utility by moving.

What does this tell us?

- Wage differences reflect cost differences: high-wage cities must be expensive, otherwise everyone would move there.
- Housing supply matters enormously: if London could build unlimited housing at £24k/year, more people could enjoy its high productivity without paying the housing premium.
- Amenities show up in prices: better weather would allow London to support even higher house prices while keeping utility equal. # TODO amenities not mentioned in this section

## The Two Equations That Rule Cities

**Spatial Equilibrium** (workers are indifferent):

$$
U(W_c - P_c H_c, H_c, \theta_c) = \bar{U}
$$

for every city $c$.

**Housing Market Clearing** (demand equals supply):

$$
P_c = f(\text{population}_c, \text{supply constraints}_c)
$$

The first equation says people achieve the same utility everywhere. The second says housing prices adjust to balance demand and supply. Together, these determine how many people live in each city, what wages are paid, and what housing costs.

This framework helps us understand why London house prices are so high. London is very productive (high $W$), so people are willing to pay more. It also has great amenities (high $\theta$), so people accept lower real wages. And critically, London doesn't build enough houses, so prices rise to ration the fixed supply.

This last point matters. If planning restrictions prevent London from expanding, the entire country is poorer. Not just Londoners, everyone. Workers who would be more productive in London are stuck elsewhere. This is the _spatial misallocation_ that economists worry about.

## Bringing Migration Dynamics to Life

So far we've compared two static snapshots: before and after equilibrium. But what happens _during_ the adjustment? How do wages and rents change as people move?

Recall our equilibrium condition: $U_A = U_B$. What if they're not equal? If London offers higher utility than Newcastle, people move to London.

Let's define $s$ as the share of total population living in City A. If $s = 0.6$, then 60% live in City A and 40% live in City B. As people migrate to City A, $s$ increases. The opposite happens in City B as people leave. As $s$ changes, so do wages and rents in both cities, which changes utilities, which affects whether people keep moving.

### How Wages Respond to Population

When more workers arrive in a city, what happens to wages? Basic supply and demand: more workers means each worker is slightly less scarce, so wages fall a bit. Economists capture this with a power law:

$$
W_A(s) = W_{A0} \cdot \left(\frac{s}{0.5}\right)^{-\eta}
$$

Here, $W_{A0}$ is the base wage when $s = 0.5$ (half the population lives in each city). The term $\frac{s}{0.5}$ measures how much bigger City A is than the reference size (i.e. if $s = 0.6$, then City A is 20% bigger than the reference size). The exponent $-\eta$ controls how sensitive wages are to population. If $\eta = 0.05$ and population doubles ($s$ goes from 0.5 to 1.0), wages fall by about 5%. #TODO check this

Why this functional form? It's simple, it matches empirical evidence reasonably well, and it ensures wages never hit zero or infinity.

<PowerLawViz />

The same logic applies to City B, using $(1-s)$ since that's City B's population share:

$$
W_B(s) = W_{B0} \cdot \left(\frac{1-s}{0.5}\right)^{-\eta}
$$

### How Rents Respond to Population

When people arrive in a city, they need somewhere to live. If housing supply is fixed, prices spike. If housing is easy to build, prices rise only slightly. We describe this with **housing supply elasticity** $\varepsilon$:

$$
P_A(s) = P_{A0} \cdot \left(\frac{s}{0.5}\right)^{\frac{1}{\varepsilon}}
$$

Here, $P_{A0}$ is the base rent when $s = 0.5$. The exponent $\frac{1}{\varepsilon}$ controls how much rents increase when population grows. Higher $\varepsilon$ means more a elastic supply - it's easier to build - so rents rise slowly. Lower $\varepsilon$ means a less elastic supply, tight planning rules, and rents that spike sharply.

Consider three scenarios. If $\varepsilon = 1.0$ and population doubles, rents double. If $\varepsilon = 0.5$ and population doubles, rents _quadruple_ (very inelastic). If $\varepsilon = 2.0$ and population doubles, rents increase by only 41% (very elastic). #TODO check this

### From Wages and Rents to Utility

Once we know wages and rents, we can calculate consumption (what's left after paying rent):

$$
C_A(s) = W_A(s) - P_A(s)
$$

And then utility using the logarithmic form from earlier:

$$
U_A(s) = \ln(C_A(s))
$$

Now we have everything we need. For any population split $s$, we can calculate wages, rents, consumption, and utility in both cities.

### What the Graph Shows

The visualization plots $U_A(s)$ and $U_B(s)$ as $s$ varies from 0 to 1.

The red line (City A) slopes downward. As $s$ increases, more people move to City A. More people means higher rents ($P_A$ increases) and slightly lower wages ($W_A$ decreases). Both effects reduce consumption ($C_A$ falls), which reduces utility ($U_A$ falls).

The blue line (City B) slopes upward. As $s$ increases, _fewer_ people live in City B (since $1-s$ decreases). Fewer people means lower rents ($P_B$ decreases) and slightly higher wages ($W_B$ increases). Both effects increase consumption ($C_B$ rises), which increases utility ($U_B$ rises).

Where do the lines cross? That's the equilibrium $s^*$ where $U_A(s^*) = U_B(s^*)$. At this point, workers are indifferent between cities, so migration stops.

### What You Can Explore

The visualisation lets you see how different parameters affect the curves.

- Adjust housing elasticity ($\varepsilon$): lower values make curves steeper. Try setting City A's elasticity to 0.3 (click "Restrictive Housing") and watch how the red curve becomes much steeper. Small population changes cause huge rent spikes.
- Change base wages: increase City A's base wage to see the entire red curve shift up. This moves the equilibrium to the right, more people in the productive city.
- Add crowding penalties: these capture quality-of-life costs (congestion, pollution, noise) as cities get crowded. A positive penalty tilts curves downward.
- Click anywhere on the chart to see the exact wages, rents, consumption, and utility at that population split. This helps you understand _why_ the curves have their shapes.

<MigrationStabilityViz />

#TODO mention simplified assumptions used in this blog i.e no agglomeration, same units of housing for everyone.
